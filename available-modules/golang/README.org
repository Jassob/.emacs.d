# -*- indent-tabs-mode: nil; -*-
#+TITLE: Go module
#+AUTHOR: Jassob
#+DATE: <2018-07-28>

* About this file
  This file contains the literate source of the Go module.

* Module
  This configuration sets up a Go mode where common-code minor mode is
  enabled together with a plethora of other useful stuff, such as
  linter and formatters etc.

  #+begin_src emacs-lisp :tangle module.el
    ;; Use package defaults for these packages
    (use-package gotest :ensure t :after go-mode
      :config
      (setq go-test-verbose t))
    (use-package go-mode
      :mode "\\.go\\'"
      :init
      (setq gofmt-command "goimports")
      (add-hook 'go-mode-hook 'common-code-mode)
      (add-hook 'go-mode-hook (lambda ()
                                (add-hook 'before-save-hook 'gofmt-before-save)))
      :bind (:map go-mode-map
                  ("C-c C-r" . go-remove-unused-imports)
                  ("C-c C-f" . gofmt)
                  ("C-c C-k" . godoc))
      :config
      (require 'projectile)
      (if (file-exists-p (concat projectile-project-root "/Makefile"))
          (set (make-local-variable 'compile-command)
               "make") ;; Use make if Makefile exists
          (set (make-local-variable 'compile-command)
               "go build -v && go test -v && go vet"))) ;; otherwise use go binary
  #+end_src
